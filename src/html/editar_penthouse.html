<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nido Sky</title>
    <link
      rel="shortcut icon"
      type="image/png"
      href="../assets/images/logos/nidosky.png"
    />
    <link rel="stylesheet" href="../assets/css/styles.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <style>
      .back-to-home {
        display: block;
        margin: 10px auto;
        padding: 5px 10px;
        background-color: #00a859;
        color: #fff;
        text-align: center;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      .back-to-home:hover {
        background-color: #008f4c;
      }
      /* Fondo general y texto */
      body {
        background-color: #e0e0e0; /* Fondo oscuro para toda la página */
        color: #e0e0e0; /* Texto claro */
      }

      /* Fondo oscuro para el menú de navegación */
      .left-sidebar {
        background-color: #ffffff; /* Color de fondo del menú de navegación */
      }

      /* Fondo oscuro para el logo */
      .brand-logo {
        background-color: #333; /* Color de fondo del logo */
        padding: 20px;
      }

      /* Estilo para el texto del menú de navegación */
      .sidebar-nav .sidebar-item a {
        color: #e0e0e0; /* Color de texto claro */
      }

      /* Hover en los elementos del menú */
      .sidebar-nav .sidebar-item a:hover {
        color: #00a859; /* Color dorado al hacer hover */
      }

      /* Estilo para los títulos de las secciones */
      h5.card-title {
        color: #00a859; /* Color dorado para los títulos de las tarjetas */
      }

      /* Estilo para los botones */
      .btn-primary {
        background-color: #00a859; /* Color dorado para el botón primario */
        border: none;
        color: #feecec; /* Color del texto en el botón */
      }

      .btn-excel {
        background-color: #00a859; /* Azul para el botón de Excel */
        color: #fff;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
      }

      .btn-excel i {
        margin-right: 5px;
      }

      .dataTables_wrapper .dataTables_paginate {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }

      .dataTables_wrapper .dataTables_info {
        display: none;
      }

      .dataTables_wrapper .dataTables_length {
        display: none;
      }

      /* Contenedor de estado */
      .status-container {
        display: flex;
        gap: 5px;
      }

      /* Botones de estado */
      .btn-status {
        border: none;
        border-radius: 50%;
        width: 2rem;
        height: 2rem;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Estado Activo */
      .btn-activo {
        background-color: #27ae60; /* Verde para activo */
      }

      /* Estado Inactivo */
      .btn-inactivo {
        background-color: #c62222; /* Rojo para inactivo */
      }

      /* Efectos de hover */
      .btn-status:hover {
        opacity: 0.8;
      }

      /* Estado Activo - Hover */
      .btn-activo:hover {
        background-color: #1e8449; /* Verde oscuro */
      }

      /* Estado Inactivo - Hover */
      .btn-inactivo:hover {
        background-color: #c0392b; /* Rojo oscuro */
      }

      /* Fondo de la tabla */
      .table {
        background-color: #2c2c2c; /* Fondo oscuro para la tabla */
        color: #e0e0e0; /* Texto claro en la tabla */
      }

      /* Fondo de las celdas de la tabla */
      .table th, .table td {
        border-color: #444; /* Color de borde oscuro */
      }

      .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
        }

        input:checked + .slider {
            background-color: #27ae60;
        }

        input:checked + .slider:before {
            transform: translateX(14px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>
  </head>

  <body>
    <!-- Body Wrapper -->
    <div
      class="page-wrapper"
      id="main-wrapper"
      data-layout="vertical"
      data-navbarbg="skin6"
      data-sidebartype="full"
      data-sidebar-position="fixed"
      data-header-position="fixed"
    >
      <!-- Sidebar Start -->
      <aside class="left-sidebar">
        <!-- Sidebar scroll-->
        <div>
          <div
            class="brand-logo d-flex align-items-center justify-content-between"
          >
            <a href="./index.html" class="text-nowrap logo-img">
              <img
                src="../assets/images/logos/nidosky.png"
                width="180"
                alt=""
              />
            </a>
            <div
              class="close-btn d-xl-none d-block sidebartoggler cursor-pointer"
              id="sidebarCollapse"
            >
              <i class="ti ti-x fs-8"></i>
            </div>
          </div>
          <!-- Sidebar navigation-->
          <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
            <ul id="sidebarnav">
              <li class="sidebar-item"><a class="sidebar-link" href="./Dashboard.html"><i
                class="ti ti-layout-dashboard"></i><span class="hide-menu">Dashboard</span></a></li>
            <li class="sidebar-item"><a class="sidebar-link" href="./Roles.html"><i
                        class="ti ti-id-badge"></i><span class="hide-menu">Roles</span></a></li>
            <!-- <li class="sidebar-item"><a class="sidebar-link" href="./Registro.html"><i
                        class="ti ti-user"></i><span class="hide-menu">Login</span></a></li> -->
            <li class="sidebar-item"><a class="sidebar-link" href="./apartamentos.html"><i
                        class="ti ti-home"></i><span class="hide-menu">Apartamentos</span></a></li>
            <li class="sidebar-item"><a class="sidebar-link" href="./descuentos.html"><i
                        class="ti ti-tag"></i><span class="hide-menu">Descuentos</span></a></li>
            <li class="sidebar-item"><a class="sidebar-link" href="./reservas.html"><i
                        class="ti ti-calendar"></i><span class="hide-menu">Reservas</span></a></li>
            <li class="sidebar-item"><a class="sidebar-link" href="./hospedaje.html"><i
                        class="ti ti-hotel"></i><span class="hide-menu">Hospedaje</span></a></li>
            </ul>
          </nav>
          <!-- End Sidebar navigation -->
        </div>
        <!-- End Sidebar scroll-->
      </aside>
      <!-- Sidebar End -->

      <!-- Main wrapper -->
      <div class="body-wrapper">
        <!-- Header Start -->
        <header class="app-header">
          <nav class="navbar navbar-expand-lg navbar-light">
            <ul class="navbar-nav">
              <li class="nav-item d-block d-xl-none">
                <a
                  class="nav-link sidebartoggler nav-icon-hover"
                  id="headerCollapse"
                  href="javascript:void(0)"
                >
                  <i class="ti ti-menu-2"></i>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link nav-icon-hover" href="javascript:void(0)">
                  <i class="ti ti-bell-ringing"></i>
                  <div class="notification bg-primary rounded-circle"></div>
                </a>
              </li>
            </ul>
            <div
              class="navbar-collapse justify-content-end px-0"
              id="navbarNav"
            >
              <ul
                class="navbar-nav flex-row ms-auto align-items-center justify-content-end"
              >
                <a
                  href="https://adminmart.com/product/modernize-free-bootstrap-admin-dashboard/"
                  target="_blank"
                  class="btn btn-primary"
                  >Download Free</a
                >
                <li class="nav-item dropdown">
                  <a
                    class="nav-link nav-icon-hover"
                    href="javascript:void(0)"
                    id="drop2"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <img
                      src="../assets/images/profile/user-1.jpg"
                      alt=""
                      width="35"
                      height="35"
                      class="rounded-circle"
                    />
                  </a>
                  <div
                    class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up"
                    aria-labelledby="drop2"
                  >
                    <div class="message-body">
                      <a
                        href="javascript:void(0)"
                        class="d-flex align-items-center gap-2 dropdown-item"
                      >
                        <i class="ti ti-user fs-6"></i>
                        <p class="mb-0 fs-3">My Profile</p>
                      </a>
                      <a
                        href="javascript:void(0)"
                        class="d-flex align-items-center gap-2 dropdown-item"
                      >
                        <i class="ti ti-mail fs-6"></i>
                        <p class="mb-0 fs-3">My Account</p>
                      </a>
                      <a
                        href="javascript:void(0)"
                        class="d-flex align-items-center gap-2 dropdown-item"
                      >
                        <i class="ti ti-list-check fs-6"></i>
                        <p class="mb-0 fs-3">My Task</p>
                      </a>
                      <a
                        href="./authentication-login.html"
                        class="btn btn-outline-primary mx-3 mt-2 d-block"
                        >Logout</a
                      >
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </nav>
        </header>
        <!-- Header End -->
        <div class="container-fluid">
          <!-- Reservas Table -->
          <div class="card">
            <div class="card-body">
              <h5 class="card-title fw-semibold mb-4">Lista de Apartamentos</h5>
              <div
                class="d-flex justify-content-between align-items-center mb-4"
              >
                <!-- Botón para abrir el modal -->
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#agregarAptoModal">
                  <i class="ti ti-plus"></i> Agregar Apartamento
                </button>
                <!-- <div class="input-group" style="max-width: 300px">
                  <input
                    type="text"
                    class="form-control"
                    id="searchInput"
                    placeholder="Buscar"
                    aria-label="search"
                  />
                </div> -->
                <button class="btn btn-excel" id="exportExcel">
                  <i class="ti ti-file-export"></i> Exportar a Excel
                </button>
              </div>
              <div class="table-responsive">
                <table id="apartamentosTable" class="table">
                  <thead>
                    <tr>
                      <th>Numero Apto</th>
                      <th>Piso</th>
                      <th>Tamaño</th>
                      <th>Tarifa</th>
                      <th>Acciones</th>
                      <th>Mobiliario</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Los datos se cargarán dinámicamente aquí -->
                  </tbody>
                </table>

                <!-- Botón de volver al inicio -->
                <button class="back-to-home" onclick="window.location.href='Apartamentos.html'">
                  Tipo de Apartamentos
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal para agregar apartamento -->
<div class="modal fade" id="agregarAptoModal" tabindex="-1" aria-labelledby="agregarAptoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="agregarAptoModalLabel">Agregar Apartamento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="formAgregarApto">
          <div class="mb-3">
            <label for="numeroApto" class="form-label">Número de Apartamento</label>
            <input type="text" class="form-control" id="numeroApto" required>
          </div>
          <div class="mb-3">
            <label for="pisoApto" class="form-label">Piso</label>
            <input type="text" class="form-control" id="pisoApto" required>
          </div>
          <div class="mb-3">
            <label for="tamanoApto" class="form-label">Tamaño</label>
            <input type="text" class="form-control" id="tamanoApto" required>
          </div>
          <div class="mb-3">
            <label for="tarifaApto" class="form-label">Tarifa</label>
            <input type="text" class="form-control" id="tarifaApto" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="guardarApto">Guardar Apartamento</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<script>
  $(document).ready(function() {
    let table = $('#apartamentosTable').DataTable({
      ajax: {
        url: 'http://localhost:3001/api/apartamentos',
        dataSrc: ''
      },
      columns: [
        { data: 'numeroApto' },
        { data: 'pisoApto' },
        { data: 'tamanoApto' },
        { data: 'tarifaApto' },
        {
          data: null,
          render: function(data, type, row) {
            return `
              <button class="btn btn-sm btn-outline-primary editar-apto" data-id="${row._id}">
                <i class="ti ti-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger eliminar-apto" data-id="${row._id}">
                <i class="ti ti-trash"></i>
              </button>
              <label class="switch">
                <input type="checkbox" ${row.estado === 'activo' ? 'checked' : ''} class="cambiar-estado" data-id="${row._id}">
                <span class="slider round"></span>
              </label>
            `;
          }
        },
        {
          data: null,
          render: function(data, type, row) {
            return `
              <a href="mobiliario.html?apartamento=${row._id}" class="btn btn-sm btn-outline-info ver-mobiliario">
                <i class="ti ti-eye"></i>
            </a>
            `;
          }
        }
      ],
      pageLength: 6,
      lengthChange: false,
      searching: true,
      language: {
        url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
      }
    });

    $('#searchInput').on('keyup', function() {
      table.search(this.value).draw();
    });

    $('#guardarApto').on('click', function() {
      let aptoData = {
        numeroApto: $('#numeroApto').val(),
        pisoApto: $('#pisoApto').val(),
        tamanoApto: $('#tamanoApto').val(),
        tarifaApto: $('#tarifaApto').val()
      };

      $.ajax({
        url: 'http://localhost:3001/api/apartamentos',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(aptoData),
        success: function(response) {
          $('#agregarAptoModal').modal('hide');
          Swal.fire('Apartamento agregado', 'El apartamento ha sido agregado con éxito.', 'success');
          table.ajax.reload();
        },
        error: function(error) {
          Swal.fire('Error', 'Hubo un error al agregar el apartamento.', 'error');
          console.error('Error:', error);
        }
      });
    });

    // Editar apartamento
    $('#apartamentosTable').on('click', '.editar-apto', function() {
      let id = $(this).data('id');
      $.get('http://localhost:3001/api/apartamentos/' + id, function(data) {
        $('#numeroApto').val(data.numeroApto);
        $('#pisoApto').val(data.pisoApto);
        $('#tamanoApto').val(data.tamanoApto);
        $('#tarifaApto').val(data.tarifaApto);
        $('#agregarAptoModal').modal('show');

        $('#guardarApto').off('click').on('click', function() {
          let aptoData = {
            numeroApto: $('#numeroApto').val(),
            pisoApto: $('#pisoApto').val(),
            tamanoApto: $('#tamanoApto').val(),
            tarifaApto: $('#tarifaApto').val()
          };

          $.ajax({
            url: 'http://localhost:3001/api/apartamentos/' + id,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(aptoData),
            success: function(response) {
              $('#agregarAptoModal').modal('hide');
              Swal.fire('Apartamento actualizado', 'El apartamento ha sido actualizado con éxito.', 'success');
              table.ajax.reload();
            },
            error: function(error) {
              Swal.fire('Error', 'Hubo un error al actualizar el apartamento.', 'error');
              console.error('Error:', error);
            }
          });
        });
      });
    });

    // Eliminar apartamento
    $('#apartamentosTable').on('click', '.eliminar-apto', function() {
      let id = $(this).data('id');

      Swal.fire({
        title: '¿Estás seguro?',
        text: "No podrás revertir esta acción",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, eliminarlo'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: 'http://localhost:3001/api/apartamentos/' + id,
            method: 'DELETE',
            success: function(response) {
              Swal.fire('Eliminado', 'El apartamento ha sido eliminado.', 'success');
              table.ajax.reload();
            },
            error: function(error) {
              Swal.fire('Error', 'Hubo un error al eliminar el apartamento.', 'error');
              console.error('Error:', error);
            }
          });
        }
      });
    });

    // Cambiar estado de apartamento (activo/inactivo)
    $('#apartamentosTable').on('change', '.cambiar-estado', function() {
      let id = $(this).data('id');
      let estado = $(this).prop('checked') ? 'activo' : 'inactivo';

      Swal.fire({
        title: '¿Estás seguro?',
        text: `El estado del apartamento cambiará a ${estado}.`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, cambiar estado',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: `http://localhost:3001/api/apartamentos/${id}/estado`,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify({ estado: estado }),
            success: function(response) {
              Swal.fire('Estado actualizado', `El estado del apartamento se ha cambiado a ${estado}.`, 'success');
              table.ajax.reload();
            },
            error: function(error) {
              Swal.fire('Error', 'Hubo un error al cambiar el estado.', 'error');
              console.error('Error:', error);
            }
          });
        } else {
          $(this).prop('checked', estado === 'activo');
        }
      });
    });

    // Exportar a Excel
    $('#exportExcel').on('click', function() {
      window.location.href = 'http://localhost:3001/api/apartamentos/exportar/excel';
    });
  });
</script>


  </body>
</html>